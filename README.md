# Проектная работа "Веб-ларек"
Это приложение - интернет-магазин с товарами для веб-разработчиков — Web-ларёк. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Карточка товара

```
interface IItem {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
  index ?: number;
}
```
Каталог карточек товара

```
interface IItemsList {
  items: IItem[];
  total: number;
}
```

Интерфейс для модели дынных карточек товара

```
interface IItemsData {
  items: IItem[];
  preview: string|null;
  basket: IItem[];
  addItem(itemId: string): void;
  getItem(itemId: string): IItem;
  deleteItem(id: string): void;
}
```

Интерфейс для данных, относящихся к контактной информации и способу оплаты пользователя.

```
interface IOrderData {
  payment: string;
  address: string;
  email: string;
  phone: string;
}
```

Интерфейс для данных заказа, которые должны быть отправлены на сервер.

```
interface IServerOrderData {
  payment: string;
  address: string;
  email: string;
  phone: string;
  total: number;
  items:string[];
}
```

Интерфейс описывающий результат успешного оформления заказа.

```
interface IOrderResult {
  id: string;
  total: number|null;
}
```

Интерфейс описывающий структуру ошибки, возвращаемой при выполнении запросов.

```
interface IRequestError {
  error: string;
}
```

Тип, представляющий собой частичный маппинг ключей интерфейса `IOrderData` на строки. Используется для хранения ошибок валидации.

```
type IFormErrors = Partial<Record<keyof IOrderData, string>>;
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой отображения, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- слой взаимодействия - презентер, отвечает за связь отображения и данных.

### Базовый код

#### Класс Api
Содержит логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс ModelData
Класс `ModelData` представляет собой хранилище данных магазина, включая список товаров, превью товара, а также корзину покупок. Он взаимодействует с событиями (`IEvents`) для оповещения других частей приложения об изменениях данных.

Свойства класса:
- `protected _items: IItem[];` Хранит список доступных товаров
- `protected _preview: string | null;` Хранит ID выбранного товара для превью
- `protected events: IEvents;` Объект для обработки событий
- `protected _basket: IItem[] = [];` Хранит товары в корзине

Конструктор:
`constructor(events: IEvents)`: Инициализирует экземпляр класса, принимая объект событий.

Так же класс предоставляет набор методов для взаимодействия с этими данными:

 - `set items(items: IItem[])` — позволяет установить (обновить) список доступных товаров и уведомляет об этом через событие `cardsList:changed`.
- `get items()` — возвращает текущий список доступных товаров.
- `set preview` и `get preview` - Установка и получение выбранного товара для превью
- `get basket()` — возвращает список всех товаров в корзине.
- `getItem(itemId: string): IItem | undefined` - ищет товар по ID в списке товаров.
- `checkInbasket(itemId: string)` — проверяет, находится ли товар с заданным `id` в корзине, возвращает `true` или `false`.
- `addItem(itemId: string)` — добавляет товар в корзину по его `id`, если его там ещё нет, и генерирует событие `basket:changed`.
- `deleteItem(itemId: string)` — удаляет товар из корзины по его `id`, если он там есть, и генерирует событие `basket:changed`.
- `updateIndex(_basket: IItem[])` — пересчитывает индексы товаров в корзине. Индексы устанавливаются в соответствии с порядком добавления товаров.
- `getTotal()` — возвращает общее количество товаров в корзине.
- `getSum()` — вычисляет и возвращает общую стоимость всех товаров в корзине.
- `getIdList()` — возвращает массив `id` всех товаров, содержащихся в корзине.
- `resetBasket()` — полностью очищает корзину и генерирует событие `basket:changed`.

#### Класс OrderData

Класс `OrderData` представляет собой модель данных заказа, содержащую информацию о платёжных реквизитах, контактных данных и механизмы валидации формы заказа. Он взаимодействует с системой событий (`IEvents`), чтобы уведомлять приложение об изменениях в данных и ошибках валидации.

Свойства класса:
- `_payment: string` — выбранный метод оплаты.
- `_address: string` — адрес доставки.
- `_email: string` — контактный email.
- `_phone: string` — контактный телефон.
- `events: IEvents` — объект событий, через который передаются оповещения.
- `formErrors: IFormErrors` — объект, содержащий ошибки валидации формы.

Конструктор `constructor(events: IEvents)`: Инициализирует объект данных заказа и связывает его с системой событий.

Методы:
- `getData(): IOrderData` - Возвращает объект с текущими данными заказа.
- `setPaymentFields(field: keyof IOrderData, value: string)` - Устанавливает значение для платежного поля и вызывает валидацию платежной формы.
- `setContactFields(field: keyof IOrderData, value: string)` - Устанавливает значение для контактного поля и вызывает валидацию контактной формы.
- Сеттеры и геттеры для `payment`, `address`, `email`, `phone` - Позволяют управлять значениями отдельных полей заказа.
- `validatePaymentForm(): boolean` - Проверяет заполненность полей оплаты и адреса. В случае ошибок вызывает событие `'formErrorsPayment:change'` с объектом валидности и списком ошибок. Возвращает `true`, если форма валидна, и `false` в противном случае.
- `validateContactForm(): boolean` - Проверяет заполненность полей email и телефона. В случае ошибок вызывает событие `'formErrorsContact:change'` с объектом валидности и списком ошибок. Возвращает `true`, если форма валидна, и `false`, если найдены ошибки.
- `resetOrder()` - Очищает все поля данных заказа.


### Слой отображения

#### Класс Component

Класс `Component<T>` является абстрактным базовым классом для создания компонентов пользовательского интерфейса в веб-приложениях. Конструктор класса принимает в качестве аргумента контейнер типа `HTMLElement`, который служит базовым элементом для размещения содержимого компонента.
Класс предоставляет набор методов для манипуляций с элементами интерфейса, включая:
- `toggleClass(element: HTMLElement, className: string, force?: boolean)`: Переключает наличие указанного класса на элементе, основываясь на флаге `force`.
- `setText(element: HTMLElement, value: unknown)`: Устанавливает текстовое содержимое указанного элемента.
- `setDisabled(element: HTMLElement, state: boolean)`: Устанавливает или убирает атрибут `disabled` у переданного HTML-элемента на основе состояния `state`.
`setHidden(element: HTMLElement)`: Скрывает элемент (устанавливает `display: none`).
- `setVisible(element: HTMLElement)`: Отображает элемент (снимает `display: none`).
- `setImage(element: HTMLImageElement, src: string, alt?: string)`: Устанавливает источник изображения и его альтернативный текст.
- `render(data?: Partial<T>): HTMLElement`: Обновляет компонент новыми данными и возвращает его контейнер.

Класс предназначен для расширения и реализации в подклассах, позволяя создавать более специализированные компоненты, которые могут управлять пользовательским интерфейсом более гибко. Такими классами являются:

##### Класс ItemView

Класс `ItemView` расширяет базовый класс `Component` и реализует функциональность для отображения элемента товара. Этот класс предназначен для визуализации информации о товаре, а также для обработки связанных событий. Класс ожидает, что элемент будет передан в качестве контейнера, а также события для обработки взаимодействий.

Свойства класса:
- `_id`: Уникальный идентификатор товара. Используется для связи карточки с конкретным товаром.
- `_title`: HTML-элемент, отображающий название товара.
- `_price`: HTML-элемент, отображающий цену товара.
- `element`: Корневой HTML-элемент карточки.
- `events`: Экземпляр интерфейса `IEvents`, обеспечивающий возможность взаимодействия через события.

Конструктор класса принимает аргументы:
  - `container` (HTMLElement): Корневой HTML-элемент, внутри которого находятся дочерние элементы карточки.
    - `events` (IEvents): Объект для управления событиями, позволяющий взаимодействовать с внешней логикой приложения.
  - Инициализируются DOM-элементы, такие как название (`_title`) и цена (`_price`).

Методы класса:
- `render(itemData: IItem): HTMLElement`:
  - Наполняет карточку данными: заголовком и ценой.
  - Возвращает контейнер карточки.
- `set id(itemId: string)` (сеттер):
  - Устанавливает уникальный идентификатор карточки товара.
- `get id: string`(геттер):
  - Возвращает текущий ID товара.
- `set title(itemTitle: string)` (сеттер):
  - Устанавливает текстовое содержимое заголовка карточки.
- `set price(itemPrice: number | null)` (сеттер):
  - Устанавливает текстовое содержимое цены карточки, добавляя единицу измерения («синапсы») или указывая «Бесценно», если цена не задана.


##### Класс PageCatalog

Класс `PageCatalog` представляет собой компонент страницы каталога, который управляет отображением элементов на странице, такими как галерея товаров и счётчик в корзине, а также предоставляет возможность блокировки страницы и обработки событий, связанных с корзиной. Класс наследует от базового компонента `Component` и позволяет динамически изменять состояние страницы каталога через предоставленные методы и свойства.

Свойства класса:
- `_basketCounter`: HTML-элемент, отображающий текущее количество товаров в корзине.
  - `_gallery`: HTML-элемент, содержащий список товаров (галерею).
  - `_basketButton`: HTML-кнопка, предназначенная для открытия корзины.
  - `_wrapper`: HTML-элемент, обёртка главного контента страницы.         Используется для управления состоянием блокировки страницы.
  - `events`: Экземпляр интерфейса `IEvents`, предоставляющий возможность подписываться и слушать события.


`constructor(container: HTMLElement, events: IEvents)`: Конструктор класса, который принимает контейнер, в котором размещены элементы компонента, и объект событий. Он инициализирует элементы страницы каталога и добавляет обработчик события `click` для кнопки корзины. При нажатии на кнопку корзины срабатывает событие `basket:open` и передаются текущие данные компонента.

Методы класса:
- `set basketCounter(count: number)`: Сеттер, который обновляет отображаемое количество товаров в корзине.
- `set gallery(items: HTMLElement[])`: Сеттер, который Обновляет содержимое галереи товаров.
- Сеттер `locked(lock: boolean)`: Управляет состоянием блокировки страницы. При активации блокировки добавляет CSS-класс `page__wrapper_locked` к обёртке страницы, при снятии блокировки — удаляет его.
- Геттер `galleryItems(): HTMLElement[]`: Возвращает список текущих элементов, находящихся в контейнере галереи.


##### Класс ItemBasketView

`ItemBasketView` — класс, расширяющий функциональность `ItemView`, предназначен для управления отображением элемента корзины. Он добавляет возможности удаления товара из корзины и отображения порядкового номера товара. Класс взаимодействует с внешними событиями через `IEvents` и предоставляет интерфейс для обновления и удаления элемента корзины.

Поля:
- `_index`: Элемент для отображения порядкового номера товара.
- `_button`: Кнопка для удаления товара из корзины.

Конструктор расширяет функциональность базового класса `ItemView`, добавляя доступ к элементам корзины (`удалить товар`, `индекс товара`). В нём также регистрируется обработчик события `click` на кнопке удаления товара, который вызывает событие `basket:item:remove`.

Методы:
- Сеттер `index(itemIndex: number)`: Устанавливает порядковый номер товара в интерфейсе корзины.

##### Класс ItemCatalogueView

`ItemCatalogueView` — это класс, расширяющий `ItemView`, предназначен для отображения товаров в каталоге. Он добавляет возможность обработки событий выбора товара, а также управления категориями и изображениями карточек. Это позволяет гибко изменять отображение карточки в каталоге товаров.
Поля:
- `_button`: HTML-кнопка-контейнер карточки товара, отвечающая за обработку кликов по карточке.
- `_category`: Элемент для отображения категории товара.
- `_image`: Изображение товара.

Конструктор инициализирует элементы, являющиеся частью карточки товара (изображение, категории, кнопка), а также задаёт обработчик кликов. При клике на карточку генерируется событие `card:select`, которое передаёт информацию об элементе в обработчик событий.

Сеттеры:
- `image`: Устанавливает изображение товара с использованием пути из CDN.
- `category`: Устанавливает категорию товара и изменяет её стили в зависимости от типа категории.

##### Класс ModalWindow

Класс `ModalWindow` представляет собой компонент модального окна, обеспечивающий его открытие, закрытие и обновление содержимого. Класс наследует функциональность базового `Component` и управляет событиями, связанными с модальным окном.

Свойства класса:
- `events`: Экземпляр `IEvents`, позволяющий общаться с другими частями приложения через события.
- `_button`: HTML-кнопка закрытия модального окна.
- `_modalContent`: HTML-элемент, содержащий контент модального окна.

Конструктор инициализирует компоненты внутри модального окна и добавляет обработчики событий для закрытия окна при клике по фону или кнопке закрытия. Событие `click` на основном контейнере предотвращает всплытие, чтобы окно не закрывалось при клике по его содержимому.

Методы:
- Сеттер `modalContent(content: HTMLElement)` : устанавливает новый контент модального окна, заменяя предыдущее содержимое.
- `open()`: открывает модальное окно, добавляя ему класс `modal_active`. При открытии генерируется событие `modal:open`.
- `close()`: закрывает модальное окно, убирая класс `modal_active`. Также очищает содержимое окна и генерирует событие `modal:close`.
- `render(data?: IModalWindow): HTMLElement`: вызывает родительский `render`, затем открывает модальное окно с новыми данными. Возвращает контейнер модального окна.


##### Класс ItemPreview

Класс `ItemPreview` представляет собой компонент предварительного просмотра товара в каталоге, который расширяет функциональность `ItemCatalogueView`. Используется для управления отображением товара и обработки его взаимодействий, таких как добавление или удаление из корзины, а также обновление текста кнопки и состояния интерфейса.

Свойства класса:
- `_description`: HTML-элемент, используемый для отображения текстового описания товара.
- `_button`: HTML-кнопка, предназначенная для добавления товара в корзину или удаления из неё.

Конструктор инициализирует элементы карточки товара, наследуемые от `ItemCatalogueView`, добавляя доступ к кнопке и описанию товара. Также регистрирует обработчики событий для кнопки: кнопка позволяет переключать состояние товара (добавление в корзину или удаление из неё) через событие `card:toggle`, а клики по кнопке предотвращают всплытие событий.

Методы:
- `render(itemData: IItem): HTMLElement`: обновляет информацию в карточке на основе объекта `itemData`. Параметры объекта (например, `id`, `title`, `price`, `image`, `category`) используются для заполнения соответствующих частей отображения. После обновления генерируется событие `preview:ready`.
- Сеттер `description(itemDescription: string)`: устанавливает текстовое описание товара.
- `updateButtonText(isInBasket: boolean, isPriceless: boolean)`: обновляет текст кнопки в зависимости от состояния товара. Если товар без цены (`isPriceless`), кнопка блокируется. Если товар уже в корзине (`isInBasket`), текст изменяется на "Удалить из корзины". В противном случае текст устанавливается на "В корзину".
- `blockButton()`: блокирует кнопку, делая её недоступной для взаимодействия.
- `unblockButton()`: разблокирует кнопку, позволяя с ней взаимодействовать.

##### Класс Basket

Класс `Basket` представляет собой компонент корзины товаров, который управляет отображением списка товаров, общей стоимостью и обработкой событий, связанных с оформлением заказа. Класс наследует `Component<IBasket>` и взаимодействует с остальной частью приложения через объект событий.

Свойства класса:
- `_basketListContainer`: HTML-элемент (`UL`), содержащий список товаров в корзине.
- `_basketPriceTotal`: HTML-элемент, отображающий общую стоимость товаров в корзине.
- `_button`: HTML-кнопка для перехода к оформлению заказа.
- `events`: Экземпляр `IEvents`, управляющий событиями в корзине.

Конструктор инициализирует контейнер корзины, кнопку оформления заказа, список товаров и элемент отображения общей суммы. Также регистрирует обработчик события на кнопку оформления заказа, который вызывает событие `order:open`.

Методы:
- Сеттер `total(totalPrice: number)`: устанавливает и отображает общую стоимость товаров в корзине.
- Сеттер `items(basketItemsArray: HTMLElement[])`: устанавливает новый список товаров в корзине.
- `clearItems(): void`: полностью очищает список товаров в корзине.
- `blockButton()`: блокирует кнопку оформления заказа, делая её недоступной.
- `unblockButton()`: разблокирует кнопку оформления заказа.
- `basketReset()`: очищает корзину, удаляя все товары.

##### Класс Form

Класс `Form<T>` является абстрактным компонентом, предназначенным для управления формами. Он предоставляет методы для обработки событий ввода и отправки формы, а также управление состоянием валидации и отображением ошибок. Класс наследуется от `Component<IForm>` и используется для создания конкретных форм.

Свойства класса:
- `_submitButton`: HTML-кнопка для отправки формы.
- `_formErrorContainer`: HTML-элемент (`span`), предназначенный для отображения ошибок формы.
- `events`: Экземпляр `IEvents`, обеспечивающий взаимодействие формы с другими частями приложения.
- `formName`: Имя формы, полученное из атрибута `name` элемента формы.
- `_handleSubmit`: Функция обработки отправки формы (может быть переопределена в наследниках).

Конструктор инициализирует форму, кнопку отправки и контейнер ошибок. Добавляет обработчики событий:
  - `submit` предотвращает стандартное поведение и вызывает событие `<имя формы>:submit`.
  - `input` отслеживает пользовательский ввод и вызывает событие `<имя формы>.<поле>:input` с введёнными данными.

Методы:
- Сеттер `valid(isValid: boolean)`: устанавливает статус валидации формы, активируя или отключая кнопку отправки.
- Геттер `form`: возвращает HTML-форму (`this.container`).
- Сеттер `errors(errorMessages: string[])`: устанавливает текст ошибок в контейнер ошибок.
- `onInput(field: keyof T, value: string)`: вызывает событие `<имя формы>.<поле>:change`, информируя об изменении поля.
- `render(data: IForm): HTMLFormElement`: обновляет состояние формы путем вызова родительского метода `render`.

##### Класс ContactForm

Класс `ContactForm` представляет собой специфическую реализацию формы, наследуемую от абстрактного класса `Form<IContactForm>`. Этот класс используется для обработки формы контактов и добавляет обработку события при клике на кнопку отправки формы.

Свойства класса:
Наследуются все свойства из родительского класса `Form<IContactForm>`.

Конструктор создаёт экземпляр контактной формы, инициализируя контейнер формы. Добавляет дополнительный обработчик событий на кнопку отправки (`_submitButton`), вызывающий событие `contacts:submit`.

##### Класс PaymentForm

Класс `PaymentForm` представляет собой специализированную форму для обработки платежей, наследуемую от `Form<IPaymentForm>`. Он позволяет управлять выбором способа оплаты, реагируя на нажатия кнопок.

Свойства класса:
- `_paymentButtons`: Массив HTML-кнопок (`button_alt`), представляющих способы оплаты.

Конструктор инициализирует форму и находит все кнопки выбора платежного метода. Добавляет обработчики событий для каждой кнопки:
  - При клике на кнопку сначала сбрасывается активное состояние у всех кнопок.
  - Затем активируется нажатая кнопка (`button_alt-active`).
  - Вызывается событие `<имя формы>.payment:input`, передающее информацию о выбранном методе оплаты.

##### Класс Success

Класс `Success` представляет собой компонент, отображающий сообщение об успешном оформлении заказа. Он управляет выводом итоговой суммы списанных средств и обработкой закрытия этого сообщения.

Свойства класса:
- `_totalPrice`: HTML-элемент, используемый для отображения общей суммы списанных синапсов.
- `_button`: HTML-кнопка, предназначенная для закрытия окна успеха.

Конструктор инициализирует компоненты окна успеха: текст с итоговой суммой и кнопку закрытия. Добавляет обработчик событий на кнопку, вызывающий событие `success:close` при нажатии.

Методы:
- Сеттер `total(total: number)`: устанавливает итоговый текст с указанной суммой списанных синапсов.


### Слой взаимодействия

#### Класс ShopApi

`ShopApi` реализует клиент для взаимодействия с API магазина. Он использует интерфейс `IApi` для выполнения HTTP-запросов к серверу. Основная задача данного класса — абстрагировать детали работы с API и предоставить методы для получения данных о товарах.

Свойства класса:
- `_baseApi`: Экземпляр `IApi`, обеспечивающий выполнение HTTP-запросов.

Конструктор:
`constructor(baseApi: IApi)`: Принимает объект API и сохраняет его для выполнения запросов.

Методы:
`getItems(): Promise<IItem[]>`
  - Выполняет запрос к API для получения списка всех товаров. Он делает GET-запрос к эндпоинту `/product/` и ожидает, что сервер вернет список товаров в формате `IItemsList`.
  Возвращаемое значение: Промис, который разрешается в массив объектов типа `IItem`.
`getItem(itemId: string): Promise<IItem>`
  - Принимает идентификатор товара и выполняет GET-запрос по эндпоинту `/product/${itemId}` для получения деталей конкретного товара. Он ожидает, что сервер вернет объект, соответствующий типу `IItem`.
  Возвращаемое значение: Промис, который разрешается в объект типа `IItem`.
`sendOrderData(orderData: IServerOrderData): Promise<IOrderResult | IRequestError>`
  - Отправляет данные заказа на сервер.
  - Возвращаемое значение:
     `Promise<IOrderResult | IRequestError>` — объект с результатом заказа или ошибкой.

### Список всех событий в приложении

В файле `index.ts` находится код необходимый для взаимосвязи отображения и данных: необходимые шаблоны HTML элементов, экземпляры классов и методы генерирующие события с помощью брокера событий:

#### 1. Загрузка данных
- `'initialData:loaded'` — получение данных с сервера;
  Вызывается после успешного получения списка товаров, инициируя их рендеринг.

#### 2. Работа с модальным окном
- `'modal:open'` — блокировка прокрутки страницы при открытии модального окна.
- `'modal:close'` — разблокировка прокрутки страницы при закрытии модального окна.

#### 3. Работа с карточками товаров
- `'card:select'` — открытие модального окна с превью карточки товара;
  Передает в модалку данные выбранного товара.
- `'preview:ready'` — проверка состояния кнопки в карточке товара;
  Проверяет, есть ли товар в корзине, и обновляет текст кнопки.
- `'card:toggle'` — добавление или удаление товара из корзины;
  Меняет состояние товара (в корзине / не в корзине) и обновляет кнопки.
- `'card:removed'` — оповещение о том, что товар был удален из корзины.
- `'card:added'` — оповещение о том, что товар был добавлен в корзину.

#### 4. Работа с корзиной
- `'basket:open'` — открытие корзины;
  Формирует список товаров в корзине и отображает их в модальном окне.
- `'basket:item:remove'` — удаление конкретного товара из корзины;
  Если корзина становится пустой, удаляет все товары из отображения и блокирует кнопку оформления заказа.
- `'basket:changed'` — обновление счетчика корзины и общей стоимости товаров.

#### 5. Работа с формой оплаты
- `'order:open'` — открытие формы оплаты;
  Открывает модальное окно с формой ввода данных по способу оплаты.
- `/^order\.:input/` — обработка ввода данных в форму оплаты;
  Валидирует введенные пользователем данные.
- `'formErrorsPayment:change'` — обновление ошибок валидации формы оплаты;
  Передает ошибки в компонент формы, обновляя ее состояние.

#### 6. Работа с формой контактов
- `'order:submit'` — открытие формы контактов после заполнения формы оплаты.
- `/^contacts\.:input/` — обработка ввода данных в форму контактов;
  Проверяет телефон и email на корректность.
- `'formErrorsContact:change'` — обновление ошибок валидации формы контактов;
  Передает ошибки в компонент формы, обновляя ее состояние.

#### 7. Отправка заказа
- `'contacts:submit'` — отправка заказа на сервер;
  Формирует объект заказа и отправляет его, очищая корзину и формы в случае успешного запроса.

#### 8. Завершение заказа
- `'success:close'` — закрытие модального окна с успешным оформлением заказа.
  Вызывается после успешного подтверждения покупки.


### Бизнес-логика

В приложение используется событийно-ориентированный подход, где Вью (View) генерирует события, Презентер (Presenter) обрабатывает события и изменяет данные в Модели (Model), после чего измененные данные передаются обратно во Вью для обновления.

Рассмотрим конкретную ситуацию — добавление товара в корзину (клик по кнопке "В корзину"):

#### 1. Вью реагирует на действие пользователя и генерирует событие.
Класс `ItemPreview`, который отвечает за отображение карточки товара, обрабатывает клик по кнопке "В корзину" и генерирует событие:
events.emit('card:toggle', { item: this });

Параметром передается объект товара (`ItemPreview`).

#### 2. Презентер обрабатывает событие и вызывает метод модели для изменения данных.
В обработчике события `card:toggle` в презентере (`events.on('card:toggle', ...)`) происходит следующее:
- Проверяется, есть ли товар в корзине (`appData.checkInbasket(item.id)`).
- Если товар есть — он удаляется (`appData.deleteItem(item.id)`).
- Если товара нет — он добавляется (`appData.addItem(item.id)`).
- Генерируется событие о добавлении (`card:added`) или удалении (`card:removed`).
- Генерируется событие для обновления корзины (`basket:changed`).

#### 3. Модель изменяет данные и генерирует событие.
Метод `addItem` объекта `appData` обновляет массив товаров в корзине и инициирует событие `'basket:changed'`.
После этого Модель уведомляет систему об изменении содержимого корзины.

#### 4. Презентер обрабатывает событие и вызывает рендер Вью, передавая в него данные из модели.
Презентер обращается к модели `appData`, получает из неё обновленные данные (`getTotal()` и `getSum()`) и передает их в Вью корзины (`Basket`).

#### 5. Вью перерисовывается, отображая обновленные данные.
Класс `Basket` обновляет:
- Счетчик товаров в UI (`page.basketCounter = appData.getTotal()`).
- Общую цену (`basket.total = appData.getSum()`).

Перерисовка UI корзины происходит автоматически, так как изменяются переданные данные.
